<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="author" content="SemiColonWeb">
    <meta name="description"
        content="Create Shop, Store &amp; eCommerce Websites with Canvas Template. Get Canvas to build powerful websites easily with the Highly Customizable &amp; Best Selling Bootstrap Template, today.">

    <link rel="icon" type="image/x-icon" href="./favicon.png">
    <!-- Font Imports -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=Montserrat:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;1,300;1,400&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Core Style -->
    <link rel="stylesheet" href="style.css">

    <!-- Font Icons -->
    <link rel="stylesheet" href="css/font-icons.css">

    <!-- Plugins/Components CSS -->
    <link rel="stylesheet" href="css/swiper.css">

    <!-- Niche Demos -->
    <link rel="stylesheet" href="demos/shop/shop.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Document Title
	============================================= -->
    <title>Narumon | Pharmacy</title>

</head>

<body class="stretched">

    <!-- Document Wrapper
	============================================= -->
    <div id="wrapper">
        <div class="loading-container" id="load" style="display: none;">
            <div class="lds-ripple">
                <div></div>
                <div></div>
            </div>
        </div>
        <!-- Login Modal -->
        <div class="modal1 mfp-hide" id="modal-login">
            <div class="card mx-auto" style="max-width: 540px;">
                <div class="card-header py-3 bg-transparent text-center">
                    <h3 class="mb-0 fw-normal">สวัสดี, ยินดีต้อนรับกลับ</h3>
                </div>
                <div class="card-body mx-auto py-5" style="max-width: 70%;">
                    <div class="mb-0 row">

                        <div class="col-12">
                            <input type="text" id="login-form-username" name="login-form-username" value=""
                                class="form-control not-dark" placeholder="บัญชีผู้ใช้">
                        </div>

                        <div class="col-12 mt-4">
                            <input type="password" id="login-form-password" name="login-form-password" value=""
                                class="form-control not-dark" placeholder="รหัสผ่าน">
                        </div>
                        <div class="col-12 mt-4">
                            <button class="button w-100 m-0" id="login-form-submit" name="login-form-submit"
                                onclick="handleLogin()">เข้าสู่ระบบ
                            </button>
                        </div>
                    </div>
                </div>
				<div class="card-footer py-4 text-center">
					<p class="mb-0">ท่านมีบัญชีแล้วหรือยัง? <a href="#modal-register" data-lightbox="inline"><u>สมัครสมาชิก</u></a></p>
				</div>
			</div>
		</div>

		<div class="modal1 mfp-hide" id="modal-register">
			<div class="card mx-auto" style="max-width: 540px;">
				<div class="card-header py-3 bg-transparent text-center">
					<h3 class="mb-0 fw-normal">สมัครสมาชิก</h3>
				</div>
				<div class="card-body mx-auto py-5" style="max-width: 70%;">
					<div class="mb-0 row">
						<div class="col-12">
							<input type="text" id="register-form-name" name="register-form-fname" value=""
								class="form-control not-dark" placeholder="ชื่อ">
						</div>
						<div class="col-12 mt-4">
							<input type="text" id="register-form-name" name="register-form-lname" value=""
								class="form-control not-dark" placeholder="นามสกุล">
						</div>
						<div class="col-12 mt-4">
							<textarea type="text" id="register-form-address" name="register-form-address" value=""
								class="form-control not-dark" placeholder="ที่อยู่"></textarea>
						</div>
						<div class="col-12 mt-4">
							<input type="text" id="register-form-tel" name="register-form-tel" value="" maxlength="10"
								class="form-control not-dark" placeholder="เบอร์โทรศัพท์">
						</div>
						<div class="col-12 mt-4">
							<input type="text" id="register-form-email" name="register-form-email" value=""
								class="form-control not-dark" placeholder="อีเมล์">
						</div>
						<div class="col-12 mt-4">
							<input type="password" id="register-form-password" name="register-form-password" value=""
								class="form-control not-dark" placeholder="รหัสผ่าน">
						</div>
						<div class="col-12 mt-4">
							<input type="password" id="register-password-again" name="register-password-again" value=""
								class="form-control not-dark" placeholder="รหัสผ่าน">
						</div>
						<div class="col-12 mt-4">
							<button class="button w-100 m-0" id="register-form-submit" name="register-form-submit"
								onclick="handleRegister()">สมัครสมาชิก
							</button>
						</div>
					</div>
				</div>
				<div class="card-footer py-4 text-center">
					<p class="mb-0">ท่านมีบัญชีแล้วหรือยัง? <a href="#modal-login" data-lightbox="inline"><u>เข้าสู่ระบบ</u></a></p>
				</div>
			</div>
		</div>

        <!-- Header
		============================================= -->
        <header id="header" class="full-header header-size-md">
            <div id="header-wrap">
                <div class="container">
                    <div class="header-row justify-content-lg-between">

                        <!-- Logo
						============================================= -->
                        <div id="logo" class="me-lg-4">
                            <a href="index.html">
                                <!-- <img class="logo-default"
									srcset="demos/shop/images/logo.png, demos/shop/images/logo@2x.png 2x"
									src="demos/shop/images/logo@2x.png" alt="Canvas Logo"> -->
                                <h2 class="logo-default font-bebas m-0">Narumon Pharmacy</h2>
                            </a>
                        </div><!-- #logo end -->


                        <div class="header-misc">

                            <!-- Top Search
							============================================= -->
                            <div id="top-account">
                            </div>

                            <!-- Top Cart
							============================================= -->
                            <div id="top-cart" class="header-misc-icon d-sm-block">
                                <a href="#" id="top-cart-trigger">
                                    <i class="uil uil-shopping-bag"></i>
                                    <span class="top-cart-number total-count"></span>
                                </a>
                                <div class="top-cart-content">
                                    <div class="top-cart-title">
                                        <h4>ตะกร้าสินค้า</h4>
                                    </div>
                                    <div class="top-cart-items">
                                        <table class="show-cart table">
                                        </table>
                                    </div>
                                    <div class="p-2 mb-3 text-center">
                                        <button class="button button-3d button-small m-0"
                                            onclick="orderDrugCreate()">ตรวจสอบรายการสินค้า</button>
                                    </div>
                                    <div class="top-cart-action">
                                        <span class="top-checkout-price total-cart"></span>
                                        <button class="button button-3d button-small m-0" id="payment" disabled="true"
                                            onclick="orderDrugDetailCreate()">ชำระเงิน</button>
                                    </div>
                                </div>
                            </div>
                            <!-- #top-cart end -->

                            <!-- Top Search
							============================================= -->
                            <div id="top-search" class="header-misc-icon">
                                <a href="#" id="top-search-trigger"><i class="uil uil-search"></i><i
                                        class="bi-x-lg"></i></a>
                            </div><!-- #top-search end -->

                        </div>

                        <div class="primary-menu-trigger">
                            <button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
                                <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
                            </button>
                        </div>

                        <!-- Primary Navigation
						============================================= -->
                        <nav class="primary-menu with-arrows me-lg-auto">

                            <ul class="menu-container">
                                <li class="menu-item current">
                                    <a class="menu-link" href="index.html">
                                        <div>หน้าหลัก</div>
                                    </a>
                                </li>
                                <li class="menu-item mega-menu">
                                    <a class="menu-link" href="all-product.html">
                                        <div>สินค้าทั้งหมด</div>
                                    </a>
                                </li>
                                <li class="menu-item current">
                                    <a class="menu-link" href="how-to-buy.html">
                                        <div>วิธีสั่งซื้อและชำระเงิน</div>
                                    </a>
                                </li>
                                <li class="menu-item current">
                                    <a class="menu-link" href="contact-us.html">
                                        <div>ติดต่อเรา</div>
                                    </a>
                                </li>
                            </ul>
                        </nav><!-- #primary-menu end -->
                    </div>
                </div>
            </div>
            <div class="header-wrap-clone"></div>
        </header><!-- #header end -->

        <section id="content">
            <div class="content-wrap" style="padding-top: 0.5rem;">
                <!-- New Arrivals Men
				============================================= -->
                <div class="container">
                    <div class="my-3 p-3 bg-body rounded shadow-sm">
                        <h4 class="border-bottom pb-2 mb-0">จัดการที่อยู่</h4>
                        <main class="container">
                            <div class="my-3 p-3 bg-body rounded shadow-sm order-list">
                            </div>
                        </main>
                    </div>
                </div>

                <div class="clear"></div>
            </div>
        </section><!-- #content end -->
    </div><!-- #wrapper end -->

    <!-- Go To Top
	============================================= -->
    <div id="gotoTop" class="bi-arrow-up"></div>

    <!-- JavaScripts
	============================================= -->
    <script src="js/plugins.min.js"></script>
    <script src="js/functions.bundle.js"></script>
    <script src="js/login.js"></script>
    <script src="js/customer.js"></script>
    <script src="js/order.js"></script>
    <script>
        // Function to fetch and display all addresses associated with the current user
        listAllAddress = async () => {
            var myHeaders = new Headers();
            let token = localStorage.getItem("token");
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", `Bearer ${token}`);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            // Fetch the list of addresses from the server
            await fetch("https://api.wakeupcoding.com/pharmacy-api/customer/listUserId", requestOptions)
                .then(async (result) => {
                    let response = await result.json();
                    let order = "";
                    if (response) {
                        let main = "";
                        let del = "";
                        // Process each address and format it into HTML elements
                        response.customer.forEach(element => {
                            // Determine the main address link based on the default status
                            main = element.defaultStatus == 'Y' ? '<a href="#" class="text-success">ที่อยู่ปัจจุบัน</a>' : `<a href="#" class="text-primary" onclick="updateAddress(${element.id})">ใช้เป็นที่อยู่หลัก</a>`;
                            // Determine the delete address link based on the default status
                            del = element.defaultStatus == 'Y' ? '' : `<a href="#" class="text-danger" onclick="deleteAddress(${element.id})">ลบที่อยู่</a>`;
                            // Construct the HTML for each address
                            order += `
                                <div class="d-flex text-muted pt-3">
                                    <svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32"
                                        xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32"
                                        preserveAspectRatio="xMidYMid slice" focusable="false">
                                        <title>Placeholder</title>
                                        <rect width="100%" height="100%" fill="${color(element.defaultStatus)}"></rect><text x="50%" y="50%"
                                            fill="${color(element.defaultStatus)}" dy=".3em">32x32</text>
                                    </svg>

                                    <div class="pb-3 mb-0 small lh-sm border-bottom w-100">
                                        <div class="d-flex justify-content-between">
                                            <strong class="d-block text-gray-dark">ชื่อ <span class="fw-light">${element.fName} ${element.lName}</span></strong>
                                            ${main}
                                        </div>
                                        <strong class="d-block text-gray-dark">เบอร์ <span class="fw-light">${element.phoneNumber}</span></strong>
                                        <div class="d-flex justify-content-between">
                                        <strong class="d-block text-gray-dark">อีเมล์ <span class="fw-light">${element.email}</span></span></strong>
                                            ${del}
                                        </div>
                                        <strong class="d-block text-gray-dark">ที่อยู่ <span class="fw-light">${element.address}</span></strong>
                                    </div>
                                </div>
                            `;
                        });

                        // Inject the formatted HTML into the UI
                        $('.order-list').html(order)
                    }
                })
                .catch((error) => {
                    console.log("error", error);
                    // Display error message if fetching data fails
                    Swal.fire({
                        icon: "error",
                        title: "ผิดพลาด",
                        text: error.error,
                    });
                });
        }
        listAllAddress();

        // Function to update the status of an address to be the main address
        updateAddress = async (id) => {
            var myHeaders = new Headers();
            let token = localStorage.getItem("token");
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", `Bearer ${token}`);

            var raw = JSON.stringify({
                "id": id,
                "status": "Y" // Setting the status to 'Y' to indicate it's the main address
            });

            var requestOptions = {
                method: 'PUT',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            // Making a PUT request to update the address status
            await fetch("https://api.wakeupcoding.com/pharmacy-api/userCustomer/updateStatus/", requestOptions)
                .then(async (result) => {
                    let response = await result.json();
                    if (response) {
                        // If the update is successful, display a success message
                        Swal.fire({
                            icon: "success",
                            title: "สำเร็จ",
                            text: response.message,
                        }).then(() => {
                            // Reload the list of addresses to reflect the changes
                            listAllAddress();
                        });
                    }
                })
                .catch((error) => {
                    console.log("error", error);
                    // Display an error message if the update fails
                    Swal.fire({
                        icon: "error",
                        title: "ผิดพลาด",
                        text: error.error,
                    });
                });
        }

        // Function to delete an address
        deleteAddress = async (id) => {
            var myHeaders = new Headers();
            let token = localStorage.getItem("token");
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", `Bearer ${token}`);

            var requestOptions = {
                method: 'DELETE',
                headers: myHeaders,
                redirect: 'follow'
            };

            // Making a DELETE request to remove the address with the specified ID
            await fetch("https://api.wakeupcoding.com/pharmacy-api/userCustomer/remove/" + id, requestOptions)
                .then(async (result) => {
                    let response = await result.json();
                    if (response) {
                        // If the deletion is successful, display a success message
                        Swal.fire({
                            icon: "success",
                            title: "สำเร็จ",
                            text: response.message,
                        }).then(() => {
                            // Reload the list of addresses to reflect the changes
                            listAllAddress();
                        });
                    }
                })
                .catch((error) => {
                    console.log("error", error);
                    // Display an error message if the deletion fails
                    Swal.fire({
                        icon: "error",
                        title: "ผิดพลาด",
                        text: error.error,
                    });
                });
        }

        // Function to set color based on status
        function color(st) {
            if (st === 'Y') return `#198754`; // Green color for 'Y' status (main address)
            if (st === 'N') return `#6c757d`; // Gray color for 'N' status (not main address)
        }
    </script>
</body>

</html>