<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="author" content="SemiColonWeb">
    <meta name="description"
        content="Create Shop, Store &amp; eCommerce Websites with Canvas Template. Get Canvas to build powerful websites easily with the Highly Customizable &amp; Best Selling Bootstrap Template, today.">

    <link rel="icon" type="image/x-icon" href="./favicon.png">
    <!-- Font Imports -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=Montserrat:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;1,300;1,400&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Core Style -->
    <link rel="stylesheet" href="style.css">

    <!-- Font Icons -->
    <link rel="stylesheet" href="css/font-icons.css">

    <!-- Plugins/Components CSS -->
    <link rel="stylesheet" href="css/swiper.css">

    <!-- Niche Demos -->
    <link rel="stylesheet" href="demos/shop/shop.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Document Title
	============================================= -->
    <title>Narumon | Pharmacy</title>

    <style>
        .fit-image {
            width: 15%;
            aspect-ratio: 3/2;
            object-fit: contain;
        }
    </style>
</head>

<body class="stretched">
    <div class="loading-container" id="load" style="display: none;">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- Document Wrapper
	============================================= -->
    <div id="wrapper">
        <!-- Login Modal -->
        <div class="modal1 mfp-hide" id="modal-register">
            <div class="card mx-auto" style="max-width: 540px;">
                <div class="card-header py-3 bg-transparent text-center">
                    <h3 class="mb-0 fw-normal">สวัสดี, ยินดีต้อนรับกลับ</h3>
                </div>
                <div class="card-body mx-auto py-5" style="max-width: 70%;">
                    <div class="mb-0 row">

                        <div class="col-12">
                            <input type="text" id="login-form-username" name="login-form-username" value=""
                                class="form-control not-dark" placeholder="บัญชีผู้ใช้">
                        </div>

                        <div class="col-12 mt-4">
                            <input type="password" id="login-form-password" name="login-form-password" value=""
                                class="form-control not-dark" placeholder="รหัสผ่าน">
                        </div>
                        <div class="col-12 mt-4">
                            <button class="button w-100 m-0" id="login-form-submit" name="login-form-submit"
                                onclick="handleLogin()">เข้าสู่ระบบ
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-4 text-center">
                    <p class="mb-0">ท่านมีบัญชีแล้วหรือยัง? <a href="#"><u>สมัครสมาชิก</u></a></p>
                </div>
            </div>
        </div>

        <!-- Header
		============================================= -->
        <header id="header" class="full-header header-size-md">
            <div id="header-wrap">
                <div class="container">
                    <div class="header-row justify-content-lg-between">

                        <!-- Logo
						============================================= -->
                        <div id="logo" class="me-lg-4">
                            <a href="index.html">
                                <!-- <img class="logo-default"
									srcset="demos/shop/images/logo.png, demos/shop/images/logo@2x.png 2x"
									src="demos/shop/images/logo@2x.png" alt="Canvas Logo"> -->
                                <h2 class="logo-default font-bebas m-0">Narumon Pharmacy</h2>
                            </a>
                        </div><!-- #logo end -->

                        <div class="header-misc">

                            <!-- Top Search
							============================================= -->
                            <div id="top-account">
                            </div>

                            <!-- Top Cart
							============================================= -->
                            <div id="top-cart" class="header-misc-icon d-sm-block">
                                <a href="#" id="top-cart-trigger">
                                    <i class="uil uil-shopping-bag"></i>
                                    <span class="top-cart-number total-count"></span>
                                </a>
                                <div class="top-cart-content">
                                    <div class="top-cart-title">
                                        <h4>ตะกร้าสินค้า</h4>
                                    </div>
                                    <div class="top-cart-items">
                                        <table class="show-cart table">
                                        </table>
                                    </div>
                                    <div class="p-2 mb-3 text-center">
                                        <button class="button button-3d button-small m-0"
                                            onclick="orderDrugCreate()">ตรวจสอบรายการสินค้า</button>
                                    </div>
                                    <div class="top-cart-action">
                                        <span class="top-checkout-price total-cart"></span>
                                        <button class="button button-3d button-small m-0" id="payment" disabled="true"
                                            onclick="orderDrugDetailCreate()">ชำระเงิน</button>
                                    </div>
                                </div>
                            </div>
                            <!-- #top-cart end -->

                            <!-- Top Search
							============================================= -->
                            <div id="top-search" class="header-misc-icon">
                                <a href="#" id="top-search-trigger"><i class="uil uil-search"></i><i
                                        class="bi-x-lg"></i></a>
                            </div><!-- #top-search end -->

                        </div>

                        <div class="primary-menu-trigger">
                            <button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
                                <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
                            </button>
                        </div>

                        <!-- Primary Navigation
						============================================= -->
                        <nav class="primary-menu with-arrows me-lg-auto">

                            <ul class="menu-container">
                                <li class="menu-item current">
                                    <a class="menu-link" href="index.html">
                                        <div>หน้าหลัก</div>
                                    </a>
                                </li>
                                <li class="menu-item mega-menu">
                                    <a class="menu-link" href="all-product.html">
                                        <div>สินค้าทั้งหมด</div>
                                    </a>
                                </li>
                                <li class="menu-item current">
                                    <a class="menu-link" href="how-to-buy.html">
                                        <div>วิธีสั่งซื้อและชำระเงิน</div>
                                    </a>
                                </li>
                                <li class="menu-item current">
                                    <a class="menu-link" href="contact-us.html">
                                        <div>ติดต่อเรา</div>
                                    </a>
                                </li>
                            </ul>
                        </nav><!-- #primary-menu end -->

                        <form class="top-search-form">
                            <input type="text" id="search" class="form-control" value="" onkeyup="handleSearch()"
                                placeholder="Type &amp; Hit Enter.." autocomplete="off">
                        </form>

                    </div>
                </div>
            </div>
            <div class="header-wrap-clone"></div>
        </header><!-- #header end -->

        <section id="content">
            <div class="content-wrap" style="padding-top: 0.5rem;">
                <!-- New Arrivals Men
				============================================= -->
                <div class="container">
                    <div class="fancy-title title-border mt-4 title-center">
                        <h4>รายการสินค้า</h4>
                    </div>
                    <div class="row col-mb-30" id="show-all-product">
                    </div>
                </div>


                <!-- Modal -->
                <div class="modal fade" id="exampleModalList" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" id="contentModal">
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </section><!-- #content end -->

    </div><!-- #wrapper end -->

    <!-- Go To Top
	============================================= -->
    <div id="gotoTop" class="bi-arrow-up"></div>

    <!-- JavaScripts
	============================================= -->
    <script src="js/plugins.min.js"></script>
    <script src="js/functions.bundle.js"></script>
    <script src="js/tooltips.js"></script>
    <script src="js/login.js"></script>
    <script src="js/customer.js"></script>
    <script src="js/order.js"></script>
    <script>
        checkKeyword = () => {
            // Get the query string from the current URL
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const param = urlParams.get('keyword');
            console.log('param:', param);

            if (param) {
                handleSearch(param)
            }
        }

        handleSearch = (key) => {
            if (!key) {
                var input = document.getElementById("search");
                var filter = input.value.toLowerCase();
            } else {
                var filter = key.toLowerCase();
            }
            var nodes = document.getElementsByClassName('target');

            for (i = 0; i < nodes.length; i++) {
                if (nodes[i].innerText.toLowerCase().includes(filter)) {
                    nodes[i].style.display = "block";
                } else {
                    nodes[i].style.display = "none";
                }
            }
        }

        getProduct = async () => {
            document.getElementById('load').style.display = 'flex';
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6ImI4MDdlYjIwLThiNWMtMTFlZS04NDNhLTM4ZjNhYjkwNDlhNSJ9.FmqfsoNTzR9yPraGKiv62TbD9CIGeP5N51Nk3UHv0Yo");
            myHeaders.append("Cookie", "isAdmin=true");

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            let response = await fetch("https://api.wakeupcoding.com/pharmacy-api/drugInformation", requestOptions)
                .then((result) => {
                    return result.json()
                })
                .catch((error) => { console.log('error', error) });
            document.getElementById('show-all-product').innerHTML = '';
            if (response) {
                let img;
                response.drugInformation.forEach(element => {
                    if (element.price) {
                        if (element.linkImages) {
                        } else {
                            img = './images/default-image.jpg'
                        }
                        document.getElementById('show-all-product').innerHTML += `
                                <div class="col-lg-3 col-md-3 col-6 px-2 target">
                                    <div class="product">
                                        <div class="product-image">
                                            <a href="#"><img src="${img}" class="fit-image" alt="Image 1"></a>
                                        </div>
                                        <div class="product-desc">
                                            <div class="product-title mb-1">
                                                <h3><a href="#">ชื่อยา ${element.name}</a></h3>
                                            </div>
                                            <div class="product-price font-primary">
                                                <ins>ขนาด ${element.size}</ins>
                                            </div>
                                            <div class="product-price font-primary">
                                                <ins>ประเภท ${element.keyword}</ins>
                                            </div>
                                            <div class="product-price font-primary">
                                                <ins>สรรพคุณ <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#exampleModalList" onclick="showModalDetail(${element.id})">ดูเพิ่มเติม...</a></ins>
                                            </div>
                                            <div class="product-price font-primary">
                                                <ins>ราคา ${element.price}฿</ins>
                                            </div>
                                            <div class="featured-content-list">
                                                <button type="button" data-name="${element.name}" data-price="${element.price}" data-id="${element.id}" onclick="addItem(event)" class="btn btn-dark w-100">Add to cart</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                    }
                });

                document.getElementById('load').style.display = 'none';
            }

            checkKeyword();
        }
        getProduct();

        showModalDetail = async (id) => {
            let modal = '';
            let img = '';
            var myHeaders = new Headers();
            let token = localStorage.getItem("token");
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", `Bearer ${token}`);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            await fetch("https://api.wakeupcoding.com/pharmacy-api/drugInformation/list/" + id, requestOptions)
                .then(async (result) => {
                    let response = await result.json();
                    console.log('response', response)
                    response = response.drugInfo[0];
                    if (response) {
                        if (response.linkImages) {
                        } else {
                            img = './images/default-image.jpg'
                        }
                        document.getElementById('contentModal').innerHTML = `
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">ชื่อยา ${response.name}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <img src="${img}" alt="Image 1">
                                <h4 class="m-0 mt-2">ประเภท</h4>
                                <h5 class="fw-light">${response.keyword}</h5>
                                <h4 class="m-0">สรรพคุณ</h4>
                                <h5 class="fw-light">${response.properties}</h5>
                                <h4 class="m-0">วิธีใช้</h4>
                                <h5 class="fw-light">${response.useMedicine}</h5>
                                <h4 class="m-0">ข้อควรระวัง</h4>
                                <h5 class="fw-light">${response.contraindications}</h5>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                            </div>
                        `;

                    }
                })
                .catch((error) => {
                    console.log("error", error);
                    Swal.fire({
                        icon: "error",
                        title: "ผิดพลาด",
                        text: error.error,
                    });
                });

        }
    </script>

</body>

</html>